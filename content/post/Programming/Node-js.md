---
title: "Node.js는 정말 싱글 스레드일까?"
date: 2024-03-25T19:49:22+09:00
draft: true
categories:
  - Programming
---

# Node.js는 싱글 스레드일까, 멀티 스레드일까?

최근 TypeScript 서버에서 여러 유저에 대해 로직을 빠르게 처리해야하는 로직을 구현할 일이 있었다.

빠르게 처리하기 위해서는 병렬 처리가 필요하다고 생각했고, Node.js는 싱글 스레드로 알고 있었는데 병렬 처리가 정말 가능한 것인지 궁금해서 더 깊게 공부하게 되었다.

이번 글에서는 그 과정에 대해 정리해보고자 한다.

### 동시성과 병렬성

먼저 용어부터 정리해보자.

- 동시성(Concurrency): 하나의 스레드가 여러 작업을 번갈아가며 처리하는 것
- 병렬성(Parallelism): 여러 스레드가 물리적으로 동시에 작업을 처리하는 것

Node.js는 싱글 스레드 이벤트 루프 기반으로 동작하기 때문에 본질적으로는 동시성을 지원한다.

하지만 I/O 작업은 커널이 처리하기 때문에 자바스크립트 코드와 I/O가 동시에 진행될 수 있다. 이 부분에서 “Node.js도 병렬 처리가 가능하다”라는 오해가 생기곤 한다.

## Node.js에서의 멀티 스레드 – Worker Threads

Node.js에서는 Worker Threads 모듈을 통해 멀티 스레드를 활용할 수 있다.

- Worker Thread는 새로운 스레드를 만들어 독립적인 자바스크립트 실행 환경을 제공합한다.
- 하지만 일반적인 언어의 스레드와 달리 **자원을 공유하지 않고 메시지(Message Passing)**로만 통신한다.
- postMessage와 on('message') 이벤트를 이용해 데이터를 주고받는다.

이 방식은 동기화 문제를 피할 수 있지만, 동시에 자원 공유가 불가능하다는 특징이 있다.

## Node.js는 왜 여전히 "싱글 스레드"일까?

Worker Thread가 있다고 해서 Node.js가 곧바로 멀티 스레드 언어가 되는 것은 아니다.

왜냐하면 Node.js의 핵심 구조는 여전히 “이벤트 루프 + 메인 스레드” 기반이기 때문이다.

Worker Thread는 별도의 스레드를 추가할 수는 있지만, 이벤트 루프가 새로 생기는 것은 아니다.

따라서 Node.js는 “기본적으로 싱글 스레드이지만, 필요할 때 멀티 스레드를 활용할 수 있다”라고 이해하는 것이 맞다.

## libuv와 스레드 풀

Node.js가 내부적으로 사용하는 핵심 엔진 중 하나가 바로 libuv이다.
libuv는 이벤트 루프를 구현하고 있으며, 자체적으로 **스레드 풀(Thread Pool, 기본 4개)**을 가지고 있다. 이 스레드 풀은 주로 블로킹 I/O 작업을 처리합니다.

- 블로킹 I/O (파일 시스템) → libuv의 스레드 풀에서 처리
- 네트워크 I/O (소켓, DB 연결) → 커널이 제공하는 Non-blocking I/O (epoll, kqueue, IOCP 등)를 활용

즉 이벤트 루프는 블로킹 작업을 직접 처리하지 않고 libuv가 스레드 풀이나 커널의 비동기 기능을 활용해 위임하는 구조이다.

## 다이어그램으로 보는 Node.js 구조

<img width="1019" height="590" alt="Image" src="https://github.com/user-attachments/assets/fbc06779-2858-4c0e-a849-a3e847a0c390" />

이 다이어그램을 통해 구조를 정리하면:

- 메인 스레드(이벤트 루프): 자바스크립트 코드를 실행하고 이벤트를 관리
- Worker Thread: 별도의 스레드로 실행, 메인 스레드와 메시지로만 통신
- libuv: 이벤트 루프 구현 + 스레드 풀 관리
- OS 커널: 네트워크 I/O를 비동기적으로 처리, 파일 시스템은 블로킹이므로 스레드 풀에서 처리

### 정리

- Node.js는 기본적으로 싱글 스레드 이벤트 루프 기반으로 동작한다.
- 하지만 Worker Threads를 통해 멀티 스레드 병렬 작업도 가능하다.
- libuv의 스레드 풀은 파일 I/O 같은 블로킹 작업을 처리한다.
- 네트워크 I/O는 커널의 비동기 처리 기능을 활용한다.

👉 따라서 Node.js는 “싱글 스레드 + 비동기 이벤트 루프”라는 본질을 유지하면서, 필요할 때 멀티 스레드(Worker Threads)를 활용할 수 있는 유연한 구조라고 볼 수 있다.
