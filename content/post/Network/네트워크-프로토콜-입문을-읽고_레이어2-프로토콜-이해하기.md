---
title: "네트워크 프로토콜 입문을 읽고 - 레이어2 프로토콜 이해하기"
date: 2026-01-12T22:23:30+09:00
draft: false
description: ""
categories :
- Network
---


# 네트워크 프로토콜 입문을 읽고 - 레이어2 프로토콜 이해하기
이번 글에서는 네트워크 프로토콜 입문 안에서 레이어2 프로토콜 이해하기 장을 읽으며 공부한 내용을 정리해보고자 한다.

<!--more-->

### L1, L2 Diagram 요약
```mermaid
flowchart LR
    subgraph S["송신단말기"]
        direction TB
        S1[데이터 링크 계층: ]
        S2[물리 계층:<br/>0101 → 신호로 변환 후 전송]
        
        S1 --> S2
    end
    
    M[케이블을 통해 전달]
    
    subgraph R["수신단말기"]
        direction TB
        R1[물리 계층:<br/>신호 → 0101로 변환]
        R2[데이터 링크 계층]
        
        R1 --> R2
    end
    
    S2 --> M
    M --> R1
    
    style S fill:#f5f5f5,stroke:#000,stroke-width:2px
    style R fill:#f5f5f5,stroke:#000,stroke-width:2px
    style M fill:#e0e0e0,stroke:#000,stroke-width:2px
    style S1 fill:#fff,stroke:#000,stroke-width:1px
    style S2 fill:#fff,stroke:#000,stroke-width:2px
    style R1 fill:#fff,stroke:#000,stroke-width:2px
    style R2 fill:#fff,stroke:#000,stroke-width:1px
```
## 물리 계층 (L1)
- **수신**: 물리 매체(물리적 신호) -> L1 -> 디지털 데이터로 변환 -> L2
- **송신**: L2 -> 디지털 데이터 -> L1 -> 물리적 신호로 변환 -> 물리 매체


## 데이터 링크 계층 (L2)
### 오류 검출
- 물리 계층이 보내주는 신호를 ‘프레임’이라는 단위로 묶고, 오류나 주소를 확인
- 디지털 데이터의 무결성 검사
- 신뢰성 보장

### 주소 지정 (MAC Address)
- LAN 안에서 **어떤 장치에게 신호를 보내야할지 식별**한다.
- 참고로 PC, 스마트폰과 같은 네트워크 장치들은 고유한 MAC 주소를 가지고 있다.

> MAC 주소
> - I/G 비트(Individual/Group 비트)
>    - 8번째 비트
>    - 통신의 종류를 나타냄: 유니캐스트 주소(1:1) vs 멀티캐스트 주소(1:N)
>    - `ff:ff:ff:ff:ff:ff`: 브로드캐스트 주소(같은 LAN에 접속하는 모든 단말)
> - U/L 비트(Universally/Locally Administered 비트)
>    - 7번째 비트
>    - 운영 관리 방법을 나타냄: 범용 주소 vs 로컬 주소

### 흐름제어
수신 장치가 데이터 처리 속도를 못 따라오면 잠시 전송을 멈추게 함.

### 요약
- 물리 계층은 디지털 데이터와 신호 변환후 전달만 진행하고,
- 데이터 링크 계층은 누가 누구에게 보내는지, 데이터가 제대로 도착했는지 확인한다.

## 이더넷
현대 네트워크에서 사용되는 레이어 2 프로토콜은 **유선 LAN이라면 이더넷, 무선 LAN이라면 Wi-Fi**를 사용한다.

### LAN (Local Area Network)
LAN은 좁은 지역 안에서 컴퓨터/장치들이 서로 연결된 네트워크 자체를 말한다. "사무실 네트워크", "집 안 Wi-Fi 네트워크" 모두 LAN이라고 할 수 있다.

L2 프로토콜의 사실상의 표준은 **이더넷**이다.

이더넷에는 어떤 포맷으로 캡슐화할 것인지, 어떻게 오류를 감지할 것인지 정의되어 있다.

중요한 것은 L2 프로토콜을 사용해서 LAN에서 통신한다는 것이다.

### 이더넷 프레임 포맷
이더넷으로 캡슐화된 패킷을 **이더넷 프레임**이라고 한다.

- 프리앰블
    - 이더넷 헤더
    - 지금부터 이더넷 프레임을 보내겠다는 신호를 의미
- 목적지/발신자 MAC 주소
    - 이더넷 헤더
    - 이더넷 네트워크에 연결된 단말을 식별하는 ID
    - 수신측 단말은 목적지 MAC 주소를 보고 자신의 주소가 아니라면 해당 이더넷 프레임을 폐기한다
- 타입
    - 이더넷 헤더
    - 네트워크 계층(L3)에서 어떤 프로토콜을 사용하고 있는지 나타내는 ID
    - ex) IPv4, IPv6
- 이더넷 페이로드
    - 네트워크 계층의 데이터 자체를 나타냄.
    - ex) 네트워크 계층에서 IP를 사용하면 이더넷 페이로드=IP 패킷
- FCS(Frame Check Sequence)
    - 이더넷 프레임이 손상되지 않았는지 확인하기 위한 필드

## ARP (주소 확인 프로토콜)
네트워크 세계에서 주소를 나타나는 것은 MAC주소(L2)와 IP주소(L3)가 있다. 이 두 주소가 독립적으로 동작하면 L2, L3 계층 내 정보가 일치하지 않아 통신이 이루어지지 않는다.
이 두 주소를 연결해서 L2, L3의 매핑 역할을 하는 프로콜이 바로 ARP(Address Resolution Protocol)이다.

네트워크 계층에서 받은 IP 패킷을 이더넷 프레임으로 캡슐화해야 한다. 하지만 **IP 주소만으로는 목적지 MAC 주소를 알 수 없다**. 따라서 ARP를 통해 IP 주소로부터 목적지 MAC 주소를 구하는데 이를 **주소 확인**이라고 한다.

### L2, L3 Diagram 요약
```mermaid
flowchart TB
    subgraph L3["네트워크 계층 (L3)"]
        direction TB
        IP[IP 패킷<br/>목적지: 192.168.1.100<br/>발신지: 192.168.1.10]
    end
    
    subgraph L2["데이터 링크 계층 (L2)"]
        direction TB
        ARP["ARP (주소 확인 프로토콜)<br/>IP 주소 → MAC 주소 변환<br/>192.168.1.100 → AA:BB:CC:DD:EE:FF"]
    end
    
    IP --> ARP
    
    style L3 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style L2 fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    style IP fill:#fff,stroke:#1976d2,stroke-width:1px
    style ARP fill:#fff3e0,stroke:#f57c00,stroke-width:2px
```

### ARP vs RARP
ARP와 반대로 동작하는 프로토콜로 RARP(Reverse Address Resolution Protocol)가 있다.

- **ARP (Address Resolution Protocol)**
    - IP 주소 → MAC 주소 변환
    - 논리적 주소(IP)에서 물리적 주소(MAC)를 찾아냄
    - 주로 송신측에서 목적지의 MAC 주소를 알아내기 위해 사용

- **RARP (Reverse Address Resolution Protocol)**
    - MAC 주소 → IP 주소 변환
    - 물리적 주소(MAC)에서 논리적 주소(IP)를 찾아냄
    - 디스크가 없는 단말이 자신의 IP 주소를 알아내기 위해 사용
    - 현재는 DHCP, BOOTP 등으로 대체되어 거의 사용되지 않음


### ARP를 통한 주소 확인의 흐름
```mermaid
sequenceDiagram
    participant Sender as 송신 장치<br/>(192.168.1.10)
    participant Network as 네트워크<br/>(브로드캐스트)
    participant Other as 다른 장치들<br/>(192.168.1.x)
    participant Target as 목적지 장치<br/>(192.168.1.100)
    
    Note over Sender: 192.168.1.100의<br/>MAC 주소를 알고 싶음
    
    Sender->>Network: ARP Request (브로드캐스트)<br/>누가 192.168.1.100인가요?<br/>MAC 주소를 알려주세요!
    
    Network->>Other: ARP Request 전달
    Network->>Target: ARP Request 전달
    
    Note over Other: IP 주소가 다르므로<br/>패킷 버림 ❌
    
    Note over Target: 내 IP 주소와 일치!<br/>응답 준비
    
    Target->>Sender: ARP Reply (유니캐스트)<br/>192.168.1.100의 MAC 주소는<br/>AA:BB:CC:DD:EE:FF 입니다
    
    Note over Sender: 목적지 MAC 주소<br/>확인 완료 ✓
```

### ARP의 캐시 기능
ARP는 브로드캐스트를 사용하기 때문에 하나의 MAC 주소를 알기 위해 해당 네트워크에 있는 모든 단말에 패킷을 보내는 비효율적인 통신을 사용한다. 이 문제를 해결하기 위해 ARP에서는 캐시 기능을 가지고 있다.

#### ARP 캐시가 실제로 쓰이는 흐름

```mermaid
flowchart TD
    Start([패킷 전송 시작]) --> Step1[목적지 IP: 192.168.1.20<br/>라우팅 테이블 확인]
    Step1 --> Route[net0 인터페이스 결정]
    Route --> Check{ARP 캐시 확인<br/>net0의 ARP 캐시에<br/>192.168.1.20 → MAC<br/>정보 있나?}
    
    Check -->|✔ HIT<br/>캐시에 있음| UseCache[캐시된 MAC 주소 사용]
    UseCache --> SendFast[즉시 데이터 전송<br/>👉 가장 빠른 경로]
    SendFast --> End1([완료])
    
    Check -->|✘ MISS<br/>캐시에 없음| ARPReq[ARP Request<br/>브로드캐스트 전송]
    ARPReq --> ARPReply[ARP Reply 수신<br/>MAC 주소 획득]
    ARPReply --> SaveCache[ARP 캐시에 저장<br/>192.168.1.20 → MAC]
    SaveCache --> SendData[데이터 전송]
    SendData --> End2([완료])
    
    style Start fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style Check fill:#fff3e0,stroke:#f57c00,stroke-width:3px
    style UseCache fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    style SendFast fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    style ARPReq fill:#ffcdd2,stroke:#c62828,stroke-width:2px
    style ARPReply fill:#ffcdd2,stroke:#c62828,stroke-width:2px
    style SaveCache fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style End1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style End2 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
```