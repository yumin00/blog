---
title: "DB에서 동시성 관리를 어떻게 할까?"
date: 2024-05-26T23:21:55+09:00
draft: true
categories :
- DataBase
- DataEngineering
---

데이터베이스에는 한 번에 많은 요청이 들어올 수 있다. 이러한 경우에 동시성 관리를 하지 않는다면, 문제가 발생할 수 있다. 데이터의 무결성을 유지하기 위해서 동시성 관리는 아주 중요하다. 데이터베이스에서는 동시성을 어떻게 관리하는지에 대해 공부해 보고자 한다.

## 잠금 (Locking)
잠금이란, 트랜잭션이 잠금을 설정했다면 해제할 때까지 데이터를 독점적으로 사용하여 다른 트랜잭션은 해당 데이터에 접근할 수 없는 것을 의미한다.

### 종류
- 공유 잠금 (Shared Locking): 트랜잭션이 특정 데이터에 대해 공유 잠금을 설정하면 해당 트랜잭션은 읽기만 가능하고, 다른 트랜잭션도 데이터 읽기가 가능하다.
- 전용 잠금 (Exclusive Locking): 트랜잭션이 특정 데이터에 대해 전용 잠금을 설정하면 해당 트랜잭션을 읽기/쓰기가 가능하고, 다른 트랜잭션은 읽기/쓰기가 모두 불가능하다.

### 블로킹 현상 (Blocking)
만약 A 트랜잭션이 name 테이블의 첫 번째 row를 수정하기 위해 전용 잠금을 설정했다고 가정해보자. name 테이블의 첫 번째 row를 읽어야하는 B 트랜잭션은 A 트랜잭션이 모두 완료할 때까지 기다려야 하는데, 이렇게 기다리는 현상을 블로킹 현상이라고 한다.

블로킹 현상은 어플리케이션의 성능에 좋지 않은 영향을 미치기 때문에 블로킹을 최소화는 것이 중요하다.

#### 블로킹 현상 완화 전략
블로킹 현상을 완화하기 위해서는 다음과 같은 전략을 세울 수 있다.

- 트랜잭션 내에서 잠금을 유지하는 시간을 최소화
- 트랜잭셔을 작게 분할하여 블로킹 현상을 완화

### 교착 상태 (DeadLock)
만약 A 트랜잭션이 name 테이블의 첫 번째 row를 수정한 뒤, age 테이블의 첫 번째 row를 수정한다고 가정해보자. 그리고 B 트랜잭션을 age 테이블의 첫 번째 row를 수정하고, name 테이블의 첫 번째 row를 수정한다.

이때, 각 트랜잭션이 전용 잠금을 사용하여 첫 번째 수정을 마친 다음, 두 번째 작업을 진행하려고 할 때 서로 수정해야하 하는 테이블이 Lock 상태로 서로의 트랜잭션이 끝날 때까지 대기하기 때문에 교착 상태에 빠질 수 있다.


