---
title: "IP"
date: 2023-08-10T22:56:15+09:00
draft: false
---

# IP
## 1. IP
### 패킷
프로토콜은 네트워크의 흐름을 파악하는 데 있어 핵심적인 역할을 한다.

IP(Internet Protocol)는 인터넷에서 데이터를 주고받을 때 사용하는 통신 규약이다. 정확히는 '패킷'을 정해진 목적지까지 운반하기 위해 사용한다.

모든 데이터는 패킷(packet)이라는 작은 조각으로 나뉘어 이동한다. 무거운 데이터를 그대로 보내면 가는 도중 회선에 문제가 생길 경우, 다시 전송하기 위해 많은 자원을 낭비할 수 있다. 패킷을 이용해 
정보를 교환하는 방식을 패킷 교환 방식이라고 한다.

#### 패킷 교환 방식
- 패킷별로 최적의 경로를 선택해 이동한다.
- 패킷은 자신에게 주어진 모든 경로 중 혼잡도, 연결 상태 등을 파악해 최적의 경로를 찾아가기 때문에 다양한 회선을 효율적으로 이용할 수 있다.
- 특정 경로에 문제가 생겨도 다른 경로로 이동하는 패킷은 안정적으로 들어올 수 있다.

### IP
IP의 주된 역할은 패킷을 정해진 목적지까지 전달하는 일이다. 외부에서 패킷이 들어오면 내 IP 주소와 맞는지 비교하고, 일치하지 않으면 다른 호스트로 전달하는 것이다.

IP는 패킷의 전달을 책임지는 프로토콜로, 패킷의 손실이나 중복 같이 상태의 이상은 확인하지 않는다.

즉, IP는 **비신뢰성** 과 **비연결성** 이라는 특징을 가진다.
> 비연결성
> 
> 해당 데이터를 받을 사람이 있는지는 고려하지 않는 것

## 2. IP 주소
IP 주소가 있기 때문에, 우리는 전세계에 있는 수억 개의 컴퓨터를 구분하고, 서로 헷갈리지 않게 통신할 수 있다.
### IPv4 주소의 구조
IP 주소는 192.168.0.1처럼 긴 숫자 사이에 점이 들어간 형태이다. 이는 IP의 네 번재 버전인 IPv4이다.

IPv4 주소는 점을 기준으로 4부분으로 나눌 수 있고, 각 자리는 0부터 255까지의 숫자로 구성되어 있다.

### 네트워크 주소와 호스트 주소
**네트워크** 란, 데이터를 통신하는 과정에서 같은 공유기를 사용하는 범위이며, 이 네트워크에 연결된 각각의 장치를 **호스트** 라고 한다.

데이터를 통신할 때 가장 먼저 해당 컴퓨터가 속한 네트워크에 진입해야하기 때문에, 이를 찾기 위한 구분자로 IP 주소의 맨 앞에 네트워크 부분을 표기한다.
그 안에서 다시 특정 호스트를 찾기 위한 구분자로 네트워크 부분의 뒤에 호스트 부분을 작성한다.

199.168.123.132 라는 IP 주소에서 .132는 호스트 부분이고 나머지가 네트워크 부분인 것이다.

네트워크에서 사용할 수 있는 IP 주소 중 맨 첫 번째 주소인 0과 맨 마지막 주소인 255는 호스트 주소로 사용할 수 없다.
192.168.123.0은 네트워크 그 자체의 주소이고, 192.168.233.255는 브로드캐스트를 위한 주소이기 때문이다.
> 브로드캐스트 주소
> 
> 특정 네트워크 주소에 속한 모든 호스트에게 패킷을 전달해야할 때 사용하는 주소

## 3. 클래스
### 네트워크 주소
네트워크 주소는 192.168.123.132라는 IP 주소에서 192까지가 네트워크 부분일 수도 있고, 192.168까지가 네트워크 부분일 수 있다.

이렇게 네트워크 주소와 호스트 주소의 구분점을 고정하지 않은 이유는 바로, IPv4에서 만들 수 있는 한정적인 IP 주소를 효율적으로 사용하기 위해서이다.

IP 주소당 호스트 주소의 개수를 고정시키면, 호스트가 많은 조직의 경우 한 개의 IP 주소만으로 충분하지 않으니 여러 개의 IP 주소를 사용하게 되고,
호스트가 적은 경우에는 사용하지 않아 낭비되는 호스트 주소가 발생하게 된다.

그 결과, 클래스라는 개념이 탄생했다.

### 클래스
A, B, C 세 클래스가 있다.
- A 클래스
  - 첫 번째 옥텟만 네트워크 영역을 나타내고, 나머지 부분은 호스트 영역을 나타냄
  - 하나의 네트워크가 가질 수 있는 호스트 수가 약 1,600만 개로 세 클래스 중 가장 많음
- B 클래스
  - 두 번째 옥텟까지 네트워크 영역
  - 약 6만 5천 개의 호스트 영역
- C 클래스
  - 세 번째 옥텟까지 네트워크 영역
  - 250개의 호스트 주소

호스트 주소를 알기 위해서는 네트워크 영역이 어디까지인지 알 필요가 있는데, 이 클래스가 어떤 클래스인지 어떻게 알 수 있을까?
IP 주소의 첫 번째 옥텟을 통해 알 수 있다.
- A 클래스 : 첫 번째 옥텟이 0~127 범위
- B 클래스 : 첫 번재 옥텟이 128~191 범위
- C 클래스 : 첫 번째 옥텟이 192~223 범위

### 클래스의 한계
대부분의 사이트가 B 클래스에 많이 할당 받았고, B 클래스가 급속도로 소진되었다.

오늘날에는 클래스 기반으로 네트워크를 구분하지 않고, CIDR 등 새로운 구분 방식으로 네트워크를 구분한다.


## 4. CIDR와 서브넷 마스크
### CIDR
CIDR(Classless Inter-Domain Routing)는 클래스 없는 도메인 간 라우팅 기법으로, 클래스 없이도 IP 주소를 할당할 수 있는 새로운 방식이다.

CIDR는 네트워크 부분과 호스트 부분의 구분점을 1비트 단위까지 가능하게 해 호스트 주소를 더 유연하게 할당할 수 있게 했다.

### 서브넷 마스크
CIDR에서 네트워크 부분을 구분하는 방법은 서브넷 마스크이다.

서브넷 마스크란, IP 주소를 2진수로 바꾸고 나란히 놓았을 때 서브넷 마스크의 1이 연속한 자릿수를 IP 주소의 네트워크 부분, 나머지 0이 있는 자릿수를 호스트 부분으로 구분한다.

### CIDR 표기법
IP 주소 - 192.168.10.1

서브넷 마스크 - 255.255.255.0

(2진수)   11111111.11111111.1111111.00000000

CIDR 표기법 - 192.169.10.1/24

원래 IP 주소를 그대로 작성하고, 그 뒤에 빗금을 붙인 후 연속된 1의 개수를 작성하여, IP 주소와 서브넷 마스크를 한눈에 파악할 수 있다.

## 5. DHCP
### 고정 IP / 유동 IP
- 고정 IP
  - 고정적으로 같은 IP를 사용
  - 서버를 운영해야 하는 등 특수한 상황에서 주로 사용
  - 사용하는 통신사의 ISP에 별도로 신청해 고정 IP를 할당받을 수 있다.
- 유동 IP
  - IP가 고정되어 있지 않고 상황에 따라 바뀌는 IP
  - 일반적으로 사용하는 것은 ISP에서 제공하는 유동 IP

### DHCP의 IP 주소 할당 방법
DHCP(Dynamic Host Configuration Protocol)는 IP가 필요한 컴퓨터에 자동으로 IP 주소를 할당해서 사용하게 해준다. IP 주소를 사용하지 않으면 반환받아 다른 컴퓨터가 사용할 수 있게 해주는 프로토콜이다.

DHCP는 주로 공유기처럼 IP 주소를 관리하는 기기에 자동으로 추가되어 있다.

[DHCP IP 주소 할당 과정]
1. IP 주소에 대한 요청이 들어옴
2. DHCP는 현재 할당할 수 있는 IP 주소를 찾음
3. 찾은 IP 주소를 빌려줌
> IP 주소를 빌려주다.
> 
> - 임대 기간을 정해 그동안만 컴퓨터가 IP 사용함.
> - DHCP에서 정한 임대 기간이 끝나기 전에 계속 IP 주소를 사용하고 싶다면 중간에 갱신 요청 가능

## 6. 사설 IP와 NAT
### 공인 IP, 사설 IP
컴퓨터마다 IP 주소를 하나씩 가져가면 IP 주소가 금방 소진될 수 있다. 따라서 특정 네트워크별로 우리가 알고 있는 고유한 IP 주소는 하나씩 가져가고, 그 네트워크 안에 있는 호스트들은 따로 가상 IP 주소를 할당해 서로 구분할 수 있게 한다.
- 공인 IP
  - 인터넷상에서 유일한 주소이자, ISP에서 공식으로 할당하는 주소
- 사설 IP
  - 특정 네트워크 내에서 사적인 용도로 이용하는 주소
  - 192.168로 시작하는 IP 주소

사설 IP는 자신이 속한 네트워크 상에서는 고유한 주소이지만, 다른 네트워크끼리는 고유하지 않다. 그렇다면 중복되는 사설 IP를 가지고 다른 컴퓨터와 어떻게 통신을 주고 받는 것일까?

이를 가능하게 하는 것이 바로, 네트워크 주소 변환인 NAT이다.

### NAT
NAT(Network Address Translation)은 네트워크 주소를 변환하는 기술로, 공유기에 자동으로 탑재되어 있다. 공인 IP에서 사설 IP로, 사설 IP에서 공인 IP로 변환한다.

[네트워크 주소 변환 방법]
1. 사용자 컴퓨터에서 유튜브 웹 서버의 특정 영상을 보고 싶다는 요청을 보냄
2. 이 메세지는 공유기에 도착
3. 공유기는 NAT를 통해 사설 IP 주소를 공인 IP 주소로 변경
4. NAT 테이블에 공인 IP와 사설 IP 저장
5. 해당 메세지를 유튜브 웹 서버에 전달
6, 유튜브 웹 서버는 데이터를 공인 IP로 전달
7. NAT는 도착한 데이터를 확인하고, NAT 테이블에서 해당 데이터의 도착지인 공인 IP와 일치하는 사설 IP로 데이터 전달

## 7. IPv6 vs IPv4
### IPv6
- 128비트로 구성
- 할당할 수 있는 IP 주소는 거의 무한대
- IP 주소 고갈을 위해 사용하는 기술이 필요없기 때문에, NAT 지원하지 않음
- IPv6 지원을 위해서는 새로운 네트워크를 구축해야 하기 때문에, 비용적인 측면으로 실제 사용하는 곳이 많지 않음